# Play an Interactive Match as Human

Play a full Semantic Poker match as the "human" player against LLM models. You (Claude) create the match, then play each turn — writing deceptive sentences as Architect or choosing doors as Player.

## Arguments

**Argument:** $ARGUMENTS

Parse these options (all optional, use defaults if not provided):

| Option | Default | Description |
|--------|---------|-------------|
| `--rounds N` | `5` | Number of rounds |
| `--name "X"` | `"Claude"` | Human player name |
| `--models m1,m2,...` | All available LLMs | Comma-separated model IDs |
| `--api URL` | `http://localhost:5000` | API base URL |

Natural language is also fine, e.g.: `3 rounds against phi3.5 and llama3.2:3b`

---

## Step 1: Preflight Check

Verify the API is running:

```bash
curl -s http://localhost:5000/api/health
```

If this fails → tell the user to start the API first:
```
dotnet run --project projects/orchestrator/src/
```

---

## Step 2: Discover Available Models

```bash
curl -s http://localhost:5000/api/models
```

List the available models to the user. If `--models` was specified, validate those models exist. If not specified, use **all available models that have `isAvailable: true`** (but at minimum 2 LLMs are needed).

If fewer than 2 available models → tell the user and abort.

---

## Step 3: Create the Match

Build the request body with PlayerSlots:

```bash
curl -s -X POST http://localhost:5000/api/matches/interactive \
  -H "Content-Type: application/json" \
  -d '{
    "totalRounds": <ROUNDS>,
    "players": [
      { "type": "Human", "name": "<PLAYER_NAME>" },
      { "type": "LLM", "modelId": "<MODEL_1>" },
      { "type": "LLM", "modelId": "<MODEL_2>" }
    ],
    "rotateArchitect": true,
    "adaptivePlay": true
  }'
```

Extract the `id` from the response. Show:

```
## Match Started: <id first 8 chars>
Players: human:<name>, <model1>, <model2>, ... | Rounds: <N>
```

Store the match ID and player ID (`human:<name>`) for subsequent calls.

---

## Step 4: Game Loop

Poll the match state repeatedly until the match completes. Use this endpoint:

```bash
curl -s http://localhost:5000/api/matches/<MATCH_ID>/interactive-state
```

### Poll Logic

1. Check `status` field:
   - `"Completed"` → go to Step 5 (final scoreboard)
   - `"Cancelled"` or `"Failed"` → show error message and abort
   - `"WaitingForHumanInput"` with `isHumanTurn: true` → it's your turn (see below)
   - Otherwise → LLMs are playing. Wait 3 seconds, then poll again.

2. Check for `lastRoundResult` — if present and you haven't shown it yet, display the round result.

### When It's Your Turn: ARCHITECT Role

If `humanRole` is `"Architect"` and `expectedInputType` is `"Architect"`:

You receive:
- `treasureDoor` — where the Treasure is (e.g. `"A"`)
- `trapDoor` — where the Trap is (e.g. `"D"`)
- `engineSentences` — 2 true statements generated by the game engine

**Your task:** Write exactly 3 deceptive sentences that will be mixed with the engine's true sentences and shown to the Player LLMs. Your goal is to trick them into choosing the Trap door and away from the Treasure.

**Strategy guidance:**
- Match the engine's rigid, formulaic style (e.g. "The Treasure is not behind Door X", "Door Y is adjacent to the Trap")
- Use misdirection — make sentences that sound truthful but point Players toward the Trap
- Mix truths and lies for plausibility
- Consider reverse psychology — sophisticated LLMs may distrust obvious statements

**Show your reasoning**, then submit:

```bash
curl -s -X POST "http://localhost:5000/api/matches/<MATCH_ID>/human-input?playerId=human:<NAME>" \
  -H "Content-Type: application/json" \
  -d '{
    "inputType": "Architect",
    "architectSentences": [
      "<sentence 1>",
      "<sentence 2>",
      "<sentence 3>"
    ]
  }'
```

Display:
```
### Round N — You are the Architect
Treasure: Door X | Trap: Door Y
Engine says: "<sentence1>" / "<sentence2>"
Your sentences:
  1. "<your sentence 1>"
  2. "<your sentence 2>"
  3. "<your sentence 3>"
Submitted! Waiting for LLMs to choose doors...
```

### When It's Your Turn: PLAYER Role

If `humanRole` is `"Player"` and `expectedInputType` is `"Player"`:

You receive:
- `shuffledSentences` — array of 5 sentences (2 truthful from engine, 3 from Architect who is trying to deceive you)

**Your task:** Analyze the 5 sentences, figure out which 2 are likely truthful engine sentences vs the 3 deceptive Architect sentences, then choose a door (A-E).

**Strategy guidance:**
- Engine sentences are rigid, formulaic, and use specific templates (e.g. "X is not behind Door Y", "X is adjacent to Y", "There are N empty doors between X and Y")
- Architect sentences may have subtle style differences or contradictions
- Look for logical consistency — if 2+ sentences contradict, one must be from the Architect
- Consider that the Architect knows where Treasure and Trap are and is actively trying to mislead you

**Show your detailed reasoning**, then submit:

```bash
curl -s -X POST "http://localhost:5000/api/matches/<MATCH_ID>/human-input?playerId=human:<NAME>" \
  -H "Content-Type: application/json" \
  -d '{
    "inputType": "Player",
    "chosenDoor": "<A-E>",
    "reasoning": "<your reasoning summary>"
  }'
```

Display:
```
### Round N — You are a Player
Sentences:
  1. "<sentence>"
  2. "<sentence>"
  3. "<sentence>"
  4. "<sentence>"
  5. "<sentence>"
Analysis: <your reasoning about which are engine vs architect sentences>
Your choice: Door <X>
Submitted!
```

### After Each Round Completes

When `lastRoundResult` appears in the state, show:

```
Results Round N:
  Architect: <architectModelId>
  Treasure: Door <X> | Trap: Door <Y>
  Choices: <player1>→Door <X> (<outcome>), <player2>→Door <Y> (<outcome>), ...
  Score changes: <player1>: <+/-N>, <player2>: <+/-N>, ...
  Running scores: <player1>: <total>, <player2>: <total>, ...
```

Then continue the game loop.

---

## Step 5: Final Scoreboard

When match status is `"Completed"`, fetch the final state and show:

```
## Match Complete!

| Rank | Player | Score |
|------|--------|-------|
| 1 | <winner> | +N |
| 2 | <player> | +N |
| 3 | <player> | -N |

Match ID: <full id>
Duration: <rounds> rounds
```

If you won, celebrate briefly. If you lost, acknowledge the LLMs' performance.

---

## Important Notes

- **Be strategic!** You are genuinely playing the game. Think carefully about each move.
- **Wait between polls.** Use `sleep 3` between poll requests to avoid hammering the API.
- **Show reasoning.** The whole point is to see how you think about deception and deduction.
- **Keep it fun.** Add brief commentary about interesting plays or surprising LLM choices.
- **Cost awareness:** If OpenAI models are in the match, each round costs real money. Mention this at match start if any `openai:*` models are involved.
